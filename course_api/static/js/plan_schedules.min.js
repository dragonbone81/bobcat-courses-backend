// var full_courses=[],raw_data=[],course_list_info=[],all_crns=[],current_id=0,schedules={},colors=['#ff7575','#ffe575','#bdff91','#b3fff2','#91b5ff','#ebaaff','#f993b9'],courses_done=[],removed_crns=[],section_data=[],current_scheds_length=0;let handle_waitlist=c=>{$('#'+c).removeClass('far'),$('#'+c).addClass('fas');fetch('/api/users/notifications/',{method:'post',credentials:'same-origin',body:JSON.stringify({crn:c}),headers:{'X-CSRFToken':csrf_token,Accept:'application/json','Content-Type':'application/json'}}).then(e=>{return e.json()}).then(e=>{e.success&&$.notify({title:'<b>Waitlist Updated</b><br>',message:'Course '+c+' has been added to your Waitlist!'},{type:'success'})})};function makeIterator(c){var d=0;return{next:function(){return d<c.length?{value:c[d++],done:!1}:(d=0,{value:c[d++],done:!1})},last:function(){d=0}}}var it=makeIterator(colors);function create_data(c){for(var d=[],e=0;e<c.length;e++){var g=['700','730','800','830','900','930','1000','1030','1100','1130','1200','1230','1300','1330','1400','1430','1500','1530','1600','1630','1700','1730','1800','1830','1900','1930','2000','2030','2100','2130','2200','2230','2300','2330'],h={M:{},T:{},W:{},R:{},F:{}};$.each(c[e].schedule,function(j,k){$.each(k,function(l,m){if(null===m)return!0;if(full_courses[e]||(full_courses[e]=[]),0===m.available&&full_courses[e].push(m.course_id),all_crns[e]||(all_crns[e]=[]),all_crns[e].push(m.crn),course_list_info[e]||(course_list_info[e]=[]),course_list_info[e].push({section_data:m,term:m.term}),courses_done[e]||(courses_done[e]={}),m.simple_name in courses_done||(courses_done[e][m.simple_name]=it.next().value),'TBD-TBD'===m.hours);else{var n=convert_24(m.hours);m.length=Math.ceil((n.end_time-n.start_time)/49),$.each(m.days.split(''),function(o,p){for(var q=g.indexOf(n.start_time.toString()),r=0;r<m.length;r++)h[p][g[q+r]]=0===r?{first:!0,data:m}:{first:!1,data:m}})}})}),it.last(),d.push(h)}return d}function convert_24(c){c=c.split('-');var d=c[0].split(':'),e=c[1].split(':');return e[1].includes('pm')&&('12'!==e[0]&&(e[0]=(parseInt(e[0])+12).toString()),'12'!==d[0]&&(d[0]=(parseInt(d[0])+12).toString())),e[1]=e[1].slice(0,2),parseInt(d[0])>parseInt(e[0])&&(d[0]=(parseInt(d[0])-12).toString()),{start_time:parseInt(d[0]+d[1]),end_time:parseInt(e[0]+e[1])}}function generate_schedules(c){for(var e,d=c.length-1;0<=d;d--){for(var f in e=!1,c[d].schedule)for(var g in c[d].schedule[f])if(null!=c[d].schedule[f][g]&&removed_crns.includes(c[d].schedule[f][g].crn)){e=!0;break}e&&c.splice(d,1)}if(current_scheds_length=c.length,0<c.length){$('#navigate_buttons').removeAttr('hidden'),$('#register').removeAttr('hidden'),$('#save_sched').removeAttr('hidden');for(var h=create_data(c),j='',k=['700','730','800','830','900','930','1000','1030','1100','1130','1200','1230','1300','1330','1400','1430','1500','1530','1600','1630','1700','1730','1800','1830','1900','1930','2000','2030','2100','2130','2200','2230','2300','2330'],l={700:'7:00am',730:'7:30am',800:'8:00am',830:'8:30am',900:'9:00am',930:'9:30am',1000:'10:00am',1030:'10:30am',1100:'11:00am',1130:'11:30am',1200:'12:00pm',1230:'12:30pm',1300:'1:00pm',1330:'1:30pm',1400:'2:00pm',1430:'2:30pm',1500:'3:00pm',1530:'3:30pm',1600:'4:00pm',1630:'4:30pm',1700:'5:00pm',1730:'5:30pm',1800:'6:00pm',1830:'6:30pm',1900:'7:00pm',1930:'7:30pm',2000:'8:00pm',2030:'8:30pm',2100:'9:00pm',2130:'9:30pm',2200:'10:00pm',2230:'10:30pm',2300:'11:00pm'},m=['M','T','W','R','F'],n=0;n<c.length;n++){j+='<div id="'+n+'" class="table-responsive col-md-12 col-lg-8 col-sm-12 col-xs-12" style="display: none;">',j+='<table class="table table-bordered table-responsive table-sm" style="font-size: smaller;">',j+='<thead> <tr class="text-center"> <th>Time</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thu</th> <th>Fri</th> </tr> </thead>',j+='<tbody id="table_body">';var o=k.indexOf(c[n].info.earliest.toString()),p=c[n].info.latest.toString();5===parseInt(p[p.length-1])&&(p=p.replaceAt(p.length-1,'0')),3>parseInt(p[p.length-2])&&(p=p.replaceAt(p.length-2,'3')),3<parseInt(p[p.length-2])&&(p=p.replaceAt(p.length-2,'0'),p=(parseInt(p)+100).toString());for(var q=k.indexOf(p),r=o;r<q+1;r++){j+='<tr>';for(var d=0;6>d;d++)if(0===d)j+='<td id="time_id_td" class="time_td">'+l[k[r]]+'</td>';else{var f=h[n][m[d-1]][k[r]];f?f.data&&f.first&&(j+='<td tabindex="0" bgcolor="'+courses_done[n][f.data.simple_name]+'" class="td-course" rowspan="'+f.data.length+'" data-toggle="popover" data-trigger="focus" title="'+f.data.type+'" data-placement="top" data-html="true" data-content="'+f.data.course_name+'<br/>CRN: '+f.data.crn+'<br/>Hours: '+f.data.hours+'<br/>Prof: '+f.data.instructor+'<br/>Enrolled: '+f.data.enrolled+'/'+f.data.capacity+'"><div id="course_id_div"><u style="color: black">'+f.data.course_id+'</u></div></td>'):j+='<td></td>'}j+='</tr>'}j+='</tbody> </table> </div>'}j+='<div class="col-lg-4 col-sm-12 col-md-12 col-xs-12"> <div class="card" style="width: 18rem;"> <div class="card-header"> <h6>My Classes:</h6> </div> <ul id="course_list_info" class="list-group list-group-flush" style="font-size: medium"> </ul></div><small style="font-size: small; float: left; margin-right: 10px">Click the heart on a full section to add to your Waitlist</small></div>',$('#main_div').html(j),$('#0').fadeIn(0,function(){}),$('#schedule_span_append').html('Total: '+c.length),make_list_info(),$(function(){$('[data-toggle="popover"]').popover({trigger:'focus'})})}else{$('#navigate_buttons').attr('hidden',!0),$('#register').attr('hidden',!0),$('#save_sched').attr('hidden',!0);var j='<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>';$('#main_div').html(j)}}String.prototype.replaceAt=function(c,d){return this.substr(0,c)+d+this.substr(c+d.length)};function make_list_info(){var c='';course_list_info[current_id].sort(function(d,e){return parseInt(d.section_data.course_id.split('-')[2])-parseInt(e.section_data.course_id.split('-')[2])}),$.each(course_list_info[current_id],function(d,e){var f='TBD-TBD'===e.section_data.hours?'<u>This section has no Time (Online?)</u>':'';let g='https://mystudentrecord.ucmerced.edu/pls/PROD/xhwschedule.P_ViewCrnDetail?subjcode='+e.section_data.course_id.split('-')[0]+'&validterm='+course_list_info[current_id][0].term+'&crn='+e.section_data.crn+'&crsenumb='+e.section_data.course_id.split('-')[1];-1===full_courses[current_id].indexOf(e.section_data.course_id)?c+='<li class="list-group-item" style="background-color:'+courses_done[current_id][e.section_data.simple_name]+';color: black"> <i class="link-desc fas fa-external-link-alt" onclick="course_info_link(\''+g+'\')"></i> &nbsp <b>'+e.section_data.course_id+'</b>: '+e.section_data.crn+'<br>'+f+'</li>':(f='<u style="color: black;">This section is full</u>',c+='<li class="list-group-item" style="background-color:'+courses_done[current_id][e.section_data.simple_name]+';color: #A94442"> <i class="link-desc fas fa-external-link-alt" onclick="course_info_link(\''+g+'\')"></i> &nbsp <b>'+e.section_data.course_id+'</b>: '+e.section_data.crn+'<i id="'+e.section_data.crn+'" onclick="handle_waitlist('+e.section_data.crn+')" style="font-size: 30px; position: absolute; right: 5%; top: 30%;cursor: pointer" class="far fa-heart"></i><br>'+f+'</li>')}),$('#courses_reg_list').html(all_crns[current_id].join(', ')),$('#course_list_info').html(c)}function toggle_tables(c,d){var e='#'+current_id;$(e).fadeOut(0,function(){}),'forward'===c&&(current_id+d>current_scheds_length-1?current_id=0:current_id+=d),'back'===c&&(0>current_id-d?current_id=current_scheds_length-1:current_id-=d),e='#'+current_id,$(e).fadeIn(300,function(){}),$('#schedule_span').text('Schedule '+(current_id+1)),make_list_info()}$('#filters').selectpicker({noneSelectedText:'Filters'});function submit_form(c){$('#main_div').html(''),$('#section_div').is(':visible')&&switch_to_sections();for(var d=$(c).serializeArray(),e=!1,f=0;f<d.length;f++)if('course_list'===d[f].name){e=!0;break}if(!e)return!1;$('#navigate_buttons').attr('hidden',!0),$('#register').attr('hidden',!0),$('#sections_info_button_div').attr('hidden',!0),$('#save_sched').attr('hidden',!0),$('#main_div').html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>'),$('#section_div').html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>'),removed_crns=[];var g='/api/courses/schedule-search/';$.ajax({type:'POST',url:g,data:d,success:function(h){if($('#main_div').html(''),schedules=h,raw_data=JSON.parse(JSON.stringify(schedules)),0<schedules.length)course_list_info=[],all_crns=[],current_id=0,$('#navigate_buttons').removeAttr('hidden'),$('#register').removeAttr('hidden'),$('#sections_info_button_div').removeAttr('hidden'),$('#save_sched').removeAttr('hidden'),generate_schedules(schedules),current_id=0,$('#schedule_span').text('Schedule '+(current_id+1)),g='/api/courses/course-match/',0<schedules.length&&$.ajax({type:'POST',url:g,data:{course_list:Object.keys(schedules[current_id].schedule),term:course_list_info[current_id][0].term,csrfmiddlewaretoken:csrf_token},success:function(k){section_data=k,generate_sections(k)}});else{$('#main_div').html('<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>')}}})}function generate_sections(c){var d='',e='<ul class="nav nav-tabs" id="myTab" role="tablist">',f='<div class="tab-content" id="myTabContent">',g=!0;for(var h in section_data)section_data[h].sort(function(j,k){return parseInt(j.course_id.split('-')[2])-parseInt(k.course_id.split('-')[2])});$.each(c,function(j,k){var l='<table class="table table-responsive table-hover table-sm"><thead> <tr> <th></th> <th>Section</th> <th>CRN</th> <th>Time</th> <th>Day(s)</th> <th>Location</th> <th>Instructor</th> <th>Units</th> <th>Enrolled</th> </tr> </thead> <tbody>';$.each(k,function(m,n){l+='<tr onclick="check_clicked(this, event)" ><td><input type="checkbox" checked="checked" id="'+n.crn+'" tabindex="0" value="'+n.crn+'-'+n.simple_name+'-'+n.type+'"><label for="'+n.course_id+'"></label></td>',l+='<td>'+get_section(n.course_id,n.type)+'</td> <td>'+n.crn+'</td> <td>'+n.hours+'</td> <td>'+n.days+'</td> <td>'+n.room+'</td> <td>'+n.instructor+'</td> <td>'+n.units+'</td> <td>'+n.enrolled+'/'+n.capacity+'</td></tr>'}),l+='</tbody></table>',f+='<div class="tab-pane fade',g&&(f+=' show active'),f+='" id="'+j+'" role="tabpanel" aria-labelledby="'+j+'-tab">'+l+'</div>',e+='<li class="nav-item">',e+='<a class="nav-link ',e+=g?'active" ':'" ',e+='id="'+j+'-tab" data-toggle="tab" href="#'+j+'" role="tab" aria-controls="'+j+'" aria-selected="'+g+'">'+j+'</a>',e+='</li>',g=!1}),f+='</div>',e+='</ul>',d+=e,d+=f,d+='<small>Yeah, currently you can deselect all the labs/disc and it will generate a schedule with the lecture...don\'t do this please :)</small>',d+='<br><small>Oh and IE/Edge is a no-no (actually most stuff should work...but not sections)</small>',$('#section_div').html(d)}function check_clicked(c,d){var e=$(':checkbox',c)[0];d.path?'checkbox'!==d.path[0].type&&(e.checked=!e.checked):d.composedPath[0]?'checkbox'!==d.composedPath[0].type&&(e.checked=!e.checked):d.composedPath()&&'checkbox'!==d.composedPath()[0].type&&(e.checked=!e.checked);var f=e.value.split('-'),g=f[1]+'-'+f[2],h='';if(~e.value.indexOf('LECT')){for(var j in section_data[g])if(section_data[g][j].lecture_crn===f[0]){if(h=$('[id^="'+section_data[g][j].crn+'"]'),!e.checked){h.prop('checked',!1);for(var k=0;k<h.length;k++)removed_crns.push(h[k].value.split('-')[0])}if(e.checked){h.prop('checked',!0);for(var k=0;k<h.length;k++)removed_crns.splice(removed_crns.indexOf(h[k].value.split('-')[0]),1)}}e.checked?removed_crns.splice(removed_crns.indexOf(f[0]),1):removed_crns.push(f[0])}if(~e.value.indexOf('LAB')||~e.value.indexOf('DISC')||~e.value.indexOf('SEM')||~e.value.indexOf('FLDW')){for(var j in section_data[g])if(section_data[g][j].attached_crn===f[0]){if(h=$('[id^="'+section_data[g][j].crn+'"]'),!e.checked){h.prop('checked',!1);for(var k=0;k<h.length;k++)removed_crns.push(h[k].value.split('-')[0])}if(e.checked){h.prop('checked',!0);for(var k=0;k<h.length;k++)removed_crns.splice(removed_crns.indexOf(h[k].value.split('-')[0]),1)}}e.checked?removed_crns.splice(removed_crns.indexOf(f[0]),1):removed_crns.push(f[0])}removed_crns=Array.from(new Set(removed_crns)),course_list_info=[],all_crns=[],current_id=0;var l=$('#class_form').serializeArray();l.push({name:'bad_crns',value:removed_crns});for(var m=!1,k=0;k<l.length;k++)if('course_list'===l[k].name){m=!0;break}if(!m)return!1;$('#main_div').html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>');$.ajax({type:'POST',url:'/api/courses/schedule-search/',data:l,success:function(o){if($('#main_div').html(''),schedules=o,raw_data=JSON.parse(JSON.stringify(schedules)),0<schedules.length)course_list_info=[],all_crns=[],current_id=0,generate_schedules(schedules),current_id=0,$('#schedule_span').text('Schedule '+(current_id+1));else{$('#main_div').html('<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>'),$('#navigate_buttons').attr('hidden',!0),$('#register').attr('hidden',!0),$('#save_sched').attr('hidden',!0)}}})}function get_section(c,d){return c=c.split('-'),c=c[c.length-1]+' '+d,c}function class_form_submit(c){var d=$(c).serializeArray();d.push({name:'crns',value:all_crns[current_id]});$.ajax({type:'POST',url:'/api/users/save-schedule/',data:d,success:function(f){var g={};f.error&&(g.error=!0,g.title=f.error,g.message='',g.type='warning'),f.success&&(g.success=!0,g.title=f.success,g.message='Go to Saved Schedules to view it',g.type='info'),$(function(){$.notify({title:g.title+'<br>',message:g.message},{type:g.type})})}})}function switch_to_sections(){$('#main_div, #section_div').toggle(200)}if($('[data-toggle="tooltip"]').tooltip(),imported_courses&&imported_term){for(var option,jcourses=$('#courses'),imp_course=0;imp_course<imported_courses.length;imp_course++)option=new Option(imported_courses[imp_course],imported_courses[imp_course]),option.selected=!0,jcourses.append(option);$('#term').val(imported_term),jcourses.trigger('change'),submit_form($('#class_form'))}let course_info_link=c=>{window.open(c,'_blank')};