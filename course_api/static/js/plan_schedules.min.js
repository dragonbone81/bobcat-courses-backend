var full_courses=[],raw_data=[],course_list_info=[],all_crns=[],current_id=0,schedules={},colors=["#ff7575","#ffe575","#bdff91","#b3fff2","#91b5ff","#ebaaff","#f993b9"],courses_done=[],removed_crns=[],section_data=[],current_scheds_length=0;function makeIterator(e){var t=0;return{next:function(){return t<e.length?{value:e[t++],done:!1}:(t=0,{value:e[t++],done:!1})},last:function(){t=0}}}var it=makeIterator(colors);function create_data(e){for(var t=[],s=0;s<e.length;s++){var r=["700","730","800","830","900","930","1000","1030","1100","1130","1200","1230","1300","1330","1400","1430","1500","1530","1600","1630","1700","1730","1800","1830","1900","1930","2000","2030","2100","2130","2200","2230","2300","2330"],a={M:{},T:{},W:{},R:{},F:{}};$.each(e[s].schedule,function(e,t){$.each(t,function(e,t){if(null===t)return!0;if(full_courses[s]||(full_courses[s]=[]),0===t.available&&full_courses[s].push(t.course_id),all_crns[s]||(all_crns[s]=[]),all_crns[s].push(t.crn),course_list_info[s]||(course_list_info[s]=[]),course_list_info[s].push({section_data:t,term:t.term}),courses_done[s]||(courses_done[s]={}),t.simple_name in courses_done||(courses_done[s][t.simple_name]=it.next().value),"TBD-TBD"===t.hours);else{var i=convert_24(t.hours);t.length=Math.ceil((i.end_time-i.start_time)/49),$.each(t.days.split(""),function(e,s){for(var n=r.indexOf(i.start_time.toString()),c=0;c<t.length;c++)a[s][r[n+c]]=0===c?{first:!0,data:t}:{first:!1,data:t}})}})}),it.last(),t.push(a)}return t}function convert_24(e){var t=(e=e.split("-"))[0].split(":"),s=e[1].split(":");return s[1].includes("pm")&&("12"!==s[0]&&(s[0]=(parseInt(s[0])+12).toString()),"12"!==t[0]&&(t[0]=(parseInt(t[0])+12).toString())),s[1]=s[1].slice(0,2),parseInt(t[0])>parseInt(s[0])&&(t[0]=(parseInt(t[0])-12).toString()),{start_time:parseInt(t[0]+t[1]),end_time:parseInt(s[0]+s[1])}}function generate_schedules(e){for(var t=e.length-1;t>=0;t--){var s=!1;for(var r in e[t].schedule)for(var a in e[t].schedule[r])if(null!=e[t].schedule[r][a]&&removed_crns.includes(e[t].schedule[r][a].crn)){s=!0;break}s&&e.splice(t,1)}if(current_scheds_length=e.length,e.length>0){$("#navigate_buttons").removeAttr("hidden"),$("#register").removeAttr("hidden"),$("#save_sched").removeAttr("hidden");for(var i=create_data(e),n="",c=["700","730","800","830","900","930","1000","1030","1100","1130","1200","1230","1300","1330","1400","1430","1500","1530","1600","1630","1700","1730","1800","1830","1900","1930","2000","2030","2100","2130","2200","2230","2300","2330"],o={700:"7:00am",730:"7:30am",800:"8:00am",830:"8:30am",900:"9:00am",930:"9:30am",1000:"10:00am",1030:"10:30am",1100:"11:00am",1130:"11:30am",1200:"12:00pm",1230:"12:30pm",1300:"1:00pm",1330:"1:30pm",1400:"2:00pm",1430:"2:30pm",1500:"3:00pm",1530:"3:30pm",1600:"4:00pm",1630:"4:30pm",1700:"5:00pm",1730:"5:30pm",1800:"6:00pm",1830:"6:30pm",1900:"7:00pm",1930:"7:30pm",2000:"8:00pm",2030:"8:30pm",2100:"9:00pm",2130:"9:30pm",2200:"10:00pm",2230:"10:30pm",2300:"11:00pm"},l=["M","T","W","R","F"],d=0;d<e.length;d++){n+='<div id="'+d+'" class="table-responsive col-md-12 col-lg-8 col-sm-12 col-xs-12" style="display: none;">',n+='<table class="table table-bordered table-responsive table-sm" style="font-size: smaller;">',n+='<thead> <tr class="text-center"> <th>Time</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thu</th> <th>Fri</th> </tr> </thead>',n+='<tbody id="table_body">';var u=c.indexOf(e[d].info.earliest.toString()),_=e[d].info.latest.toString();5===parseInt(_[_.length-1])&&(_=_.replaceAt(_.length-1,"0")),parseInt(_[_.length-2])<3&&(_=_.replaceAt(_.length-2,"3")),parseInt(_[_.length-2])>3&&(_=_.replaceAt(_.length-2,"0"),_=(parseInt(_)+100).toString());for(var h=c.indexOf(_),m=u;m<h+1;m++){n+="<tr>";for(t=0;t<6;t++){if(0===t)n+='<td id="time_id_td" class="time_td">'+o[c[m]]+"</td>";else(r=i[d][l[t-1]][c[m]])?r.data&&r.first&&(n+='<td tabindex="0" bgcolor="'+courses_done[d][r.data.simple_name]+'" class="td-course" rowspan="'+r.data.length+'" data-toggle="popover" data-trigger="focus" title="'+r.data.type+'" data-placement="top" data-html="true" data-content="'+r.data.course_name+"<br/>CRN: "+r.data.crn+"<br/>Hours: "+r.data.hours+"<br/>Prof: "+r.data.instructor+"<br/>Enrolled: "+r.data.enrolled+"/"+r.data.capacity+'"><div id="course_id_div"><u style="color: black">'+r.data.course_id+"</u></div></td>"):n+="<td></td>"}n+="</tr>"}n+="</tbody> </table> </div>"}n+='<div class="col-lg-4 col-sm-12 col-md-12 col-xs-12"> <div class="card" style="width: 18rem;"> <div class="card-header"> <h6>My Classes:</h6> </div> <ul id="course_list_info" class="list-group list-group-flush" style="font-size: medium"> </ul> </div> </div>',$("#main_div").html(n),$("#0").fadeIn(0,function(){}),$("#schedule_span_append").html("Total: "+e.length),make_list_info(),$(function(){$('[data-toggle="popover"]').popover({trigger:"focus"})})}else{$("#navigate_buttons").attr("hidden",!0),$("#register").attr("hidden",!0),$("#save_sched").attr("hidden",!0);n='<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>';$("#main_div").html(n)}}function make_list_info(){var e="";$.each(course_list_info[current_id],function(t,s){var r;r="TBD-TBD"===s.section_data.hours?"<u>This section has no Time (Online?)</u>":"",-1===full_courses[current_id].indexOf(s.section_data.course_id)?e+='<li class="list-group-item" style="background-color:'+courses_done[current_id][s.section_data.simple_name]+';color: black"> <b>'+s.section_data.course_id+"</b>: "+s.section_data.crn+"<br>"+r+"</li>":(r='<u style="color: black;">This section is full</u>',e+='<li class="list-group-item" style="background-color:'+courses_done[current_id][s.section_data.simple_name]+';color: #A94442"> <b>'+s.section_data.course_id+"</b>: "+s.section_data.crn+"<br>"+r+"</li>")}),$("#courses_reg_list").html(all_crns[current_id].join(", ")),$("#course_list_info").html(e)}function toggle_tables(e,t){var s="#"+current_id;$(s).fadeOut(0,function(){}),"forward"===e&&(current_id+t>current_scheds_length-1?current_id=0:current_id+=t),"back"===e&&(current_id-t<0?current_id=current_scheds_length-1:current_id-=t),s="#"+current_id,$(s).fadeIn(300,function(){}),$("#schedule_span").text("Schedule "+(current_id+1)),make_list_info()}function submit_form(e){$("#main_div").html(""),$("#section_div").is(":visible")&&switch_to_sections();for(var t=$(e).serializeArray(),s=!1,r=0;r<t.length;r++)if("course_list"===t[r].name){s=!0;break}if(!s)return!1;$("#navigate_buttons").attr("hidden",!0),$("#register").attr("hidden",!0),$("#sections_info_button_div").attr("hidden",!0),$("#save_sched").attr("hidden",!0),$("#main_div").html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>'),$("#section_div").html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>'),removed_crns=[];var a="/api/courses/schedule-search/";$.ajax({type:"POST",url:a,data:t,success:function(e){if($("#main_div").html(""),schedules=e,raw_data=JSON.parse(JSON.stringify(schedules)),schedules.length>0)course_list_info=[],all_crns=[],current_id=0,$("#navigate_buttons").removeAttr("hidden"),$("#register").removeAttr("hidden"),$("#sections_info_button_div").removeAttr("hidden"),$("#save_sched").removeAttr("hidden"),generate_schedules(schedules),current_id=0,$("#schedule_span").text("Schedule "+(current_id+1)),a="/api/courses/course-match/",schedules.length>0&&$.ajax({type:"POST",url:a,data:{course_list:Object.keys(schedules[current_id].schedule),term:course_list_info[current_id][0].term,csrfmiddlewaretoken:csrf_token},success:function(e){section_data=e,generate_sections(e)}});else{$("#main_div").html('<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>')}}})}function generate_sections(e){var t="",s='<ul class="nav nav-tabs" id="myTab" role="tablist">',r='<div class="tab-content" id="myTabContent">',a=!0;for(var i in section_data)section_data[i].sort(function(e,t){return parseInt(e.course_id.split("-")[2])-parseInt(t.course_id.split("-")[2])});$.each(e,function(e,t){var i='<table class="table table-responsive table-hover table-sm"><thead> <tr> <th></th> <th>Section</th> <th>CRN</th> <th>Time</th> <th>Day(s)</th> <th>Location</th> <th>Instructor</th> <th>Units</th> <th>Enrolled</th> </tr> </thead> <tbody>';$.each(t,function(e,t){i+='<tr onclick="check_clicked(this, event)" ><td><input type="checkbox" checked="checked" id="'+t.crn+'" tabindex="0" value="'+t.crn+"-"+t.simple_name+"-"+t.type+'"><label for="'+t.course_id+'"></label></td>',i+="<td>"+get_section(t.course_id,t.type)+"</td> <td>"+t.crn+"</td> <td>"+t.hours+"</td> <td>"+t.days+"</td> <td>"+t.room+"</td> <td>"+t.instructor+"</td> <td>"+t.units+"</td> <td>"+t.enrolled+"/"+t.capacity+"</td></tr>"}),i+="</tbody></table>",r+='<div class="tab-pane fade',a&&(r+=" show active"),r+='" id="'+e+'" role="tabpanel" aria-labelledby="'+e+'-tab">'+i+"</div>",s+='<li class="nav-item">',s+='<a class="nav-link ',s+=a?'active" ':'" ',s+='id="'+e+'-tab" data-toggle="tab" href="#'+e+'" role="tab" aria-controls="'+e+'" aria-selected="'+a+'">'+e+"</a>",s+="</li>",a=!1}),t+=s+="</ul>",t+=r+="</div>",t+="<small>Yeah, currently you can deselect all the labs/disc and it will generate a schedule with the lecture...don't do this plz :)</small>",$("#section_div").html(t)}function check_clicked(e,t){var s=$(":checkbox",e)[0];t.path?"checkbox"!==t.path[0].type&&(s.checked=!s.checked):t.composedPath[0]?"checkbox"!==t.composedPath[0].type&&(s.checked=!s.checked):t.composedPath()&&"checkbox"!==t.composedPath()[0].type&&(s.checked=!s.checked);var r=s.value.split("-"),a=r[1]+"-"+r[2],i="";if(~s.value.indexOf("LECT")){for(var n in section_data[a])if(section_data[a][n].lecture_crn===r[0]){if(i=$('[id^="'+section_data[a][n].crn+'"]'),!s.checked){i.prop("checked",!1);for(var c=0;c<i.length;c++)removed_crns.push(i[c].value.split("-")[0])}if(s.checked){i.prop("checked",!0);for(c=0;c<i.length;c++)removed_crns.splice(removed_crns.indexOf(i[c].value.split("-")[0]),1)}}s.checked?removed_crns.splice(removed_crns.indexOf(r[0]),1):removed_crns.push(r[0])}if(~s.value.indexOf("LAB")||~s.value.indexOf("DISC")||~s.value.indexOf("SEM")||~s.value.indexOf("FLDW")){for(var n in section_data[a])if(section_data[a][n].attached_crn===r[0]){if(i=$('[id^="'+section_data[a][n].crn+'"]'),!s.checked){i.prop("checked",!1);for(c=0;c<i.length;c++)removed_crns.push(i[c].value.split("-")[0])}if(s.checked){i.prop("checked",!0);for(c=0;c<i.length;c++)removed_crns.splice(removed_crns.indexOf(i[c].value.split("-")[0]),1)}}s.checked?removed_crns.splice(removed_crns.indexOf(r[0]),1):removed_crns.push(r[0])}removed_crns=Array.from(new Set(removed_crns)),course_list_info=[],all_crns=[],current_id=0;var o=$("#class_form").serializeArray();o.push({name:"bad_crns",value:removed_crns});var l=!1;for(c=0;c<o.length;c++)if("course_list"===o[c].name){l=!0;break}if(!l)return!1;$("#main_div").html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>');$.ajax({type:"POST",url:"/api/courses/schedule-search/",data:o,success:function(e){if($("#main_div").html(""),schedules=e,raw_data=JSON.parse(JSON.stringify(schedules)),schedules.length>0)course_list_info=[],all_crns=[],current_id=0,generate_schedules(schedules),current_id=0,$("#schedule_span").text("Schedule "+(current_id+1));else{$("#main_div").html('<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>'),$("#navigate_buttons").attr("hidden",!0),$("#register").attr("hidden",!0),$("#save_sched").attr("hidden",!0)}}})}function get_section(e,t){return e=(e=e.split("-"))[e.length-1]+" "+t}function class_form_submit(e){var t=$(e).serializeArray();t.push({name:"crns",value:all_crns[current_id]});$.ajax({type:"POST",url:"/api/users/save-schedule/",data:t,success:function(e){var t={};e.error&&(t.error=!0,t.title=e.error,t.message="",t.type="warning"),e.success&&(t.success=!0,t.title=e.success,t.message="Go to Saved Schedules to view it",t.type="info"),$(function(){$.notify({title:t.title+"<br>",message:t.message},{type:t.type})})}})}function switch_to_sections(){$("#main_div, #section_div").toggle(200)}if(String.prototype.replaceAt=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)},$("#filters").selectpicker({noneSelectedText:"Filters"}),$('[data-toggle="tooltip"]').tooltip(),imported_courses&&imported_term){for(var jcourses=$("#courses"),imp_course=0;imp_course<imported_courses.length;imp_course++){var option=new Option(imported_courses[imp_course],imported_courses[imp_course]);option.selected=!0,jcourses.append(option)}$("#term").val(imported_term),jcourses.trigger("change"),submit_form($("#class_form"))}