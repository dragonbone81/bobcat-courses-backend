var full_courses=[],raw_data=[],course_list_info=[],all_crns=[],current_id=0,schedules={},colors=["#ff7575","#ffe575","#bdff91","#91ffec","#91b5ff","#ebaaff","#f993b9"],courses_done=[],removed_crns=[],section_data=[],current_scheds_length=0;function makeIterator(e){var t=0;return{next:function(){return t<e.length?{value:e[t++],done:!1}:(t=0,{value:e[t++],done:!1})},last:function(){t=0}}}var it=makeIterator(colors);function create_data(e){for(var t=[],r=0;r<e.length;r++){var s=["700","730","800","830","900","930","1000","1030","1100","1130","1200","1230","1300","1330","1400","1430","1500","1530","1600","1630","1700","1730","1800","1830","1900","1930","2000","2030","2100","2130","2200","2230","2300","2330"],a={M:{},T:{},W:{},R:{},F:{}};$.each(e[r].schedule,function(e,t){$.each(t,function(e,t){if(null===t)return!0;if(full_courses[r]||(full_courses[r]=[]),0===t.available&&full_courses[r].push(t.course_id),all_crns[r]||(all_crns[r]=[]),all_crns[r].push(t.crn),course_list_info[r]||(course_list_info[r]=[]),course_list_info[r].push({section_data:t,term:t.term}),courses_done[r]||(courses_done[r]={}),t.simple_name in courses_done||(courses_done[r][t.simple_name]=it.next().value),"TBD-TBD"===t.hours);else{var i=convert_24(t.hours);t.length=Math.ceil((i.end_time-i.start_time)/50),$.each(t.days.split(""),function(e,r){for(var n=s.indexOf(i.start_time.toString()),c=0;c<t.length;c++)a[r][s[n+c]]=0===c?{first:!0,data:t}:{first:!1,data:t}})}})}),it.last(),t.push(a)}return t}function convert_24(e){var t=(e=e.split("-"))[0].split(":"),r=e[1].split(":");return r[1].includes("pm")&&("12"!==r[0]&&(r[0]=(parseInt(r[0])+12).toString()),"12"!==t[0]&&(t[0]=(parseInt(t[0])+12).toString())),r[1]=r[1].slice(0,2),parseInt(t[0])>parseInt(r[0])&&(t[0]=(parseInt(t[0])-12).toString()),{start_time:parseInt(t[0]+t[1]),end_time:parseInt(r[0]+r[1])}}function generate_schedules(e){for(var t=e.length-1;t>=0;t--){var r=!1;for(var s in e[t].schedule)for(var a in e[t].schedule[s])if(null!=e[t].schedule[s][a]&&removed_crns.includes(e[t].schedule[s][a].crn)){r=!0;break}r&&e.splice(t,1)}if(current_scheds_length=e.length,e.length>0){$("#navigate_buttons").removeAttr("hidden"),$("#register").removeAttr("hidden"),$("#save_sched").removeAttr("hidden");for(var i=create_data(e),n="",c=["700","730","800","830","900","930","1000","1030","1100","1130","1200","1230","1300","1330","1400","1430","1500","1530","1600","1630","1700","1730","1800","1830","1900","1930","2000","2030","2100","2130","2200","2230","2300","2330"],o={700:"7:00am",730:"7:30am",800:"8:00am",830:"8:30am",900:"9:00am",930:"9:30am",1e3:"10:00am",1030:"10:30am",1100:"11:00am",1130:"11:30am",1200:"12:00pm",1230:"12:30pm",1300:"1:00pm",1330:"1:30pm",1400:"2:00pm",1430:"2:30pm",1500:"3:00pm",1530:"3:30pm",1600:"4:00pm",1630:"4:30pm",1700:"5:00pm",1730:"5:30pm",1800:"6:00pm",1830:"6:30pm",1900:"7:00pm",1930:"7:30pm",2e3:"8:00pm",2030:"8:30pm",2100:"9:00pm",2130:"9:30pm",2200:"10:00pm",2230:"10:30pm",2300:"11:00pm"},l=["M","T","W","R","F"],d=0;d<e.length;d++){n+='<div id="'+d+'" class="table-responsive col-md-12 col-lg-8 col-sm-12 col-xs-12" style="display: none;">',n+='<table class="table table-bordered table-responsive table-sm" style="font-size: smaller;">',n+='<thead> <tr class="text-center"> <th>Time</th> <th>Mon</th> <th>Tue</th> <th>Wed</th> <th>Thu</th> <th>Fri</th> </tr> </thead>',n+='<tbody id="table_body">';var u=c.indexOf(e[d].info.earliest.toString()),_=e[d].info.latest.toString();5===parseInt(_[_.length-1])&&(_=_.replaceAt(_.length-1,"0")),parseInt(_[_.length-2])<3&&(_=_.replaceAt(_.length-2,"3")),parseInt(_[_.length-2])>3&&(_=_.replaceAt(_.length-2,"0"),_=(parseInt(_)+100).toString());for(var h=c.indexOf(_),m=u;m<h+1;m++){for(n+="<tr>",t=0;t<6;t++)0===t?n+='<td id="time_id_td" class="time_td">'+o[c[m]]+"</td>":(s=i[d][l[t-1]][c[m]])?s.data&&s.first&&(n+='<td tabindex="0" bgcolor="'+courses_done[d][s.data.simple_name]+'" class="td-course" rowspan="'+s.data.length+'" data-toggle="popover" data-trigger="focus" title="'+s.data.type+'" data-placement="top" data-html="true" data-content="'+s.data.course_name+"<br/>CRN: "+s.data.crn+"<br/>Hours: "+s.data.hours+"<br/>Prof: "+s.data.instructor+"<br/>Enrolled: "+s.data.enrolled+"/"+s.data.capacity+'"><div id="course_id_div"><u style="color: black">'+s.data.course_id+"</u></div></td>"):n+="<td></td>";n+="</tr>"}n+="</tbody> </table> </div>"}n+='<div class="col-lg-4 col-sm-12 col-md-12 col-xs-12"> <div class="card" style="width: 18rem;"> <div class="card-header"> <h6>My Classes:</h6> </div> <ul id="course_list_info" class="list-group list-group-flush" style="font-size: medium"> </ul> </div> </div>',$("#main_div").html(n),$("#0").fadeIn(0,function(){}),$("#schedule_span_append").html("Total: "+e.length),make_list_info(),$(function(){$('[data-toggle="popover"]').popover({trigger:"focus"})})}else $("#navigate_buttons").attr("hidden",!0),$("#register").attr("hidden",!0),$("#save_sched").attr("hidden",!0),n='<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>',$("#main_div").html(n)}function make_list_info(){var e="";$.each(course_list_info[current_id],function(t,r){var s;s="TBD-TBD"===r.section_data.hours?"<u>This section has no Time (Online?)</u>":"",-1===full_courses[current_id].indexOf(r.section_data.course_id)?e+='<li class="list-group-item" style="background-color:'+courses_done[current_id][r.section_data.simple_name]+';color: black"> <b>'+r.section_data.course_id+"</b>: "+r.section_data.crn+"<br>"+s+"</li>":(s='<u style="color: black;">This section is full</u>',e+='<li class="list-group-item" style="background-color:'+courses_done[current_id][r.section_data.simple_name]+';color: #A94442"> <b>'+r.section_data.course_id+"</b>: "+r.section_data.crn+"<br>"+s+"</li>")}),$("#courses_reg_list").html(all_crns[current_id].join(", ")),$("#course_list_info").html(e)}function toggle_tables(e,t){var r="#"+current_id;$(r).fadeOut(0,function(){}),"forward"===e&&(current_id+t>current_scheds_length-1?current_id=0:current_id+=t),"back"===e&&(current_id-t<0?current_id=current_scheds_length-1:current_id-=t),r="#"+current_id,$(r).fadeIn(300,function(){}),$("#schedule_span").text("Schedule "+(current_id+1)),make_list_info()}function submit_form(e){$("#section_div").is(":visible")&&switch_to_sections();for(var t=$(e).serializeArray(),r=!1,s=0;s<t.length;s++)if("course_list"===t[s].name){r=!0;break}if(!r)return!1;$("#navigate_buttons").attr("hidden",!0),$("#register").attr("hidden",!0),$("#sections_info_button_div").attr("hidden",!0),$("#save_sched").attr("hidden",!0),$("#main_div").html('<i style="font-size: 15em;padding: 30px;margin: auto" class="fas fa-sync fa-spin"></i>');var a="/api/courses/schedule-search/";$.ajax({type:"POST",url:a,data:t,success:function(e){$("#main_div").html(""),schedules=e,raw_data=JSON.parse(JSON.stringify(schedules)),schedules.length>0?(course_list_info=[],all_crns=[],current_id=0,$("#navigate_buttons").removeAttr("hidden"),$("#register").removeAttr("hidden"),$("#sections_info_button_div").removeAttr("hidden"),$("#save_sched").removeAttr("hidden"),generate_schedules(schedules),current_id=0,$("#schedule_span").text("Schedule "+(current_id+1)),a="/api/courses/course-match/",$.ajax({type:"POST",url:a,data:{course_list:Object.keys(schedules[current_id].schedule),term:course_list_info[current_id][0].term,csrfmiddlewaretoken:csrf_token},success:function(e){section_data=e,generate_sections(e)}})):$("#main_div").html('<div class="alert alert-danger" role="alert" style="margin: auto"> <strong>No available Schedules!</strong> There are conflicts :*(</div>')}})}function generate_sections(e){var t="",r='<ul class="nav nav-tabs" id="myTab" role="tablist">',s='<div class="tab-content" id="myTabContent">',a=!0;for(var i in section_data)section_data[i].sort(function(e,t){return parseInt(e.course_id.split("-")[2])-parseInt(t.course_id.split("-")[2])});$.each(e,function(e,t){var i='<table class="table table-responsive table-hover table-sm"><thead> <tr> <th></th> <th>Section</th> <th>CRN</th> <th>Time</th> <th>Day(s)</th> <th>Location</th> <th>Instructor</th> <th>Units</th> <th>Enrolled</th> </tr> </thead> <tbody>';$.each(t,function(e,t){i+='<tr><td><input type="checkbox" onclick="check_clicked(this)" checked="checked" id="'+t.crn+'" tabindex="0" value="'+t.crn+"-"+t.simple_name+"-"+t.type+'"><label for="'+t.course_id+'"></label></td>',i+="<td>"+get_section(t.course_id,t.type)+"</td> <td>"+t.crn+"</td> <td>"+t.hours+"</td> <td>"+t.days+"</td> <td>"+t.room+"</td> <td>"+t.instructor+"</td> <td>"+t.units+"</td> <td>"+t.enrolled+"/"+t.capacity+"</td></tr>"}),i+="</tbody></table>",s+='<div class="tab-pane fade',a&&(s+=" show active"),s+='" id="'+e+'" role="tabpanel" aria-labelledby="'+e+'-tab">'+i+"</div>",r+='<li class="nav-item">',r+='<a class="nav-link ',r+=a?'active" ':'" ',r+='id="'+e+'-tab" data-toggle="tab" href="#'+e+'" role="tab" aria-controls="'+e+'" aria-selected="'+a+'">'+e+"</a>",r+="</li>",a=!1}),t+=r+="</ul>",t+=s+="</div>",$("#section_div").html(t)}function check_clicked(e){var t=e.value.split("-"),r=t[1]+"-"+t[2],s="";if(~e.value.indexOf("LECT")){for(var a in section_data[r])if(section_data[r][a].lecture_crn===t[0]){if(s=$('[id^="'+section_data[r][a].crn+'"]'),!e.checked){s.prop("checked",!1);for(var i=0;i<s.length;i++)removed_crns.push(s[i].value.split("-")[0])}if(e.checked)for(s.prop("checked",!0),i=0;i<s.length;i++)removed_crns.splice(removed_crns.indexOf(s[i].value.split("-")[0]),1)}e.checked?removed_crns.splice(removed_crns.indexOf(t[0]),1):removed_crns.push(t[0])}if(~e.value.indexOf("LAB")||~e.value.indexOf("DISC")||~e.value.indexOf("SEM")||~e.value.indexOf("FLDW")){for(var a in section_data[r])if(section_data[r][a].attached_crn===t[0]){if(s=$('[id^="'+section_data[r][a].crn+'"]'),!e.checked)for(s.prop("checked",!1),i=0;i<s.length;i++)removed_crns.push(s[i].value.split("-")[0]);if(e.checked)for(s.prop("checked",!0),i=0;i<s.length;i++)removed_crns.splice(removed_crns.indexOf(s[i].value.split("-")[0]),1)}e.checked?removed_crns.splice(removed_crns.indexOf(t[0]),1):removed_crns.push(t[0])}course_list_info=[],all_crns=[],current_id=0,generate_schedules(JSON.parse(JSON.stringify(raw_data))),current_id=0,$("#schedule_span").text("Schedule "+(current_id+1))}function get_section(e,t){return(e=e.split("-"))[e.length-1]+" "+t}function class_form_submit(e){var t=$(e).serializeArray();t.push({name:"crns",value:all_crns[current_id]}),$.ajax({type:"POST",url:"/api/users/save-schedule/",data:t,success:function(e){var t={};e.error&&(t.error=!0,t.title=e.error,t.message="",t.type="warning"),e.success&&(t.success=!0,t.title=e.success,t.message="Go to Saved Schedules to view it",t.type="info"),$(function(){$.notify({title:t.title+"<br>",message:t.message},{type:t.type})})}})}function switch_to_sections(){$("#main_div, #section_div").toggle(200)}if(String.prototype.replaceAt=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)},$("#filters").selectpicker({noneSelectedText:"Filters"}),$('[data-toggle="tooltip"]').tooltip(),imported_courses&&imported_term){for(var jcourses=$("#courses"),imp_course=0;imp_course<imported_courses.length;imp_course++){var option=new Option(imported_courses[imp_course],imported_courses[imp_course]);option.selected=!0,jcourses.append(option)}$("#term").val(imported_term),jcourses.trigger("change"),submit_form($("#class_form"))}